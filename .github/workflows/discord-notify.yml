name: Discord Commit Notification

on:
  push:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Notify Discord
        run: |
          SHORT_SHA=$(echo "${{ github.event.head_commit.id }}" | cut -c1-7)
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          AUTHOR="${{ github.event.head_commit.author.name }}"
          BRANCH="${{ github.ref_name }}"
          REPO="${{ github.repository }}"

          # Construire un JSON propre (EOF = Ã©vite les Ã©chappements)
          cat <<EOF > payload.json
          {
            "embeds": [{
              "title": "ðŸ“Œ Nouveau commit sur $REPO",
              "description": "**Message du commit :** $COMMIT_MSG",
              "color": 3447003,
              "fields": [
                { "name": "Commit", "value": "$SHORT_SHA", "inline": true },
                { "name": "Branche", "value": "$BRANCH", "inline": true },
                { "name": "Auteur", "value": "$AUTHOR", "inline": true }
              ],
              "footer": { "text": "GitHub Actions â€¢ Push dÃ©tectÃ©" }
            }]
          }
          EOF

          curl -H "Content-Type: application/json" \
               -X POST \
               -d @payload.json \
               ${{ secrets.DISCORD_WEBHOOK }}
