name: Discord Commit Notification Embed

on:
  push:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord Embed
        run: |
          # RÃ©cupÃ©rer les infos du dernier commit
          SHORT_SHA=${GITHUB_EVENT_HEAD_COMMIT_ID:0:7}
          COMMIT_MSG="${GITHUB_EVENT_HEAD_COMMIT_MESSAGE}"
          COMMIT_URL="${GITHUB_EVENT_HEAD_COMMIT_URL}"
          AUTHOR="${GITHUB_EVENT_HEAD_COMMIT_AUTHOR_NAME}"
          BRANCH="${GITHUB_REF_NAME}"

          # Envoyer l'embed sur Discord
          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{
              \"embeds\": [{
                \"title\": \"ðŸ“Œ Nouveau commit sur ${{ github.repository }}\",
                \"description\": \"**Message du commit :** $COMMIT_MSG\",
                \"color\": 3447003,
                \"fields\": [
                  {\"name\": \"Commit\", \"value\": \"[$SHORT_SHA]($COMMIT_URL)\", \"inline\": true},
                  {\"name\": \"Branche\", \"value\": \"$BRANCH\", \"inline\": true},
                  {\"name\": \"Auteur\", \"value\": \"$AUTHOR\", \"inline\": true}
                ],
                \"footer\": {\"text\": \"GitHub Actions â€¢ Push dÃ©tectÃ©\"}
              }]
            }" \
            ${{ secrets.DISCORD_WEBHOOK }}
